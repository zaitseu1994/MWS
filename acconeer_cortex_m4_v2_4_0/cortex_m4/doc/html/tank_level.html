<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Acconeer SDK: Tank Level</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 66px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('tank_level.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Tank Level </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Source Code</h2>
<p><a class="el" href="ref__app__tank__level_8c.html">ref_app_tank_level.c</a></p>
<h2>Description</h2>
<p>The tank level reference application shows how the Acconeer's Distance Detector can be used to measure the fluid level in a tank by measuring the distance in three sectors (close, mid, and far). The application will measure the distance from the sensor to the fluid surface. If the height of the tank is known, the distance to the water surface can be used to calculate the fluid level from the bottom of the tank. Using this formula:</p>
<div class="fragment"><div class="line">fluid_level = height_of_tank - distance_to_surface</div></div><!-- fragment --><p>The application uses different configurations to optimize for the specific range. The first range is measuring very close to the sensor (-0.11 to 0.12 m) and utilizes recorded threshold to filter out the direct leakage and static objects in the tank. Since the close range is measuring in the range of direct leakage, the distance measurement will be less accurate than beyond the direct leakage. Also, it only measures if there are any sample points above the threshold and reports the distance to the first sample point above the threshold. This will make the distance measurement less accurate and it should be used to detect if the surface is inside the close range or not, rather than measuring the actual distance.</p>
<div class="image">
<img src="close-range-detection.png" alt="Detection withing the close range"/>
</div>
<p>{width=80%}</p>
<p>If no surface is detected in the first sector, the application measures in the mid range (0.1 to 0.47 m). The mid range also utilizes recorded threshold to filter out static objects. In this sector, it is possible to measure the distance to the surface accurately compared to the close range.</p>
<div class="image">
<img src="mid-range-detection.png" alt="Detection within the mid range"/>
</div>
<p>{width=80%}</p>
<p>When recording the background of the close and mid range, the fluid level must be outside the range, i.e. further away than 0.47 m from the sensor. Otherwise, the water might not be detected accurately since it will be part of the recorded background.</p>
<p>For larger tanks (height &gt;0.5 m), the far range (0.19 to 1.49 m) will be used when the fluid level is beyond the mid range sector. The far range utilizes Constant False Alarm Rate (CFAR) threshold to accurately detect the distance to the fluid level. The CFAR threshold will require no background recording, which means it uses less memory but might detect static objects.</p>
<div class="image">
<img src="far-range-no-detection.png" alt="No detection withing the far range. Bottom of tank at ~0.8 m and floor at ~1.1 m"/>
</div>
<p>{width=80%}</p>
<p>One measurement for the application consists of the distance detector measuring these three ranges. If a peak is detected, the ranges further out are skipped. This is to avoid strong double reflections.</p>
<p>If there is a long time between measurements in the application, the sensor should be recalibrated before starting a measurement using the sensor_calibration function. The sensor needs to be recalibrated to account for changes in the surrounding environment.</p>
<h2>Testing</h2>
<h3>Test setup</h3>
<p>The reference application is tested using a plastic water tank. The volume of the tank is 220 liters and the height is 0.785 m and the diameter 0.67 m. It is set up according to the images below using an XM122 IoT module and LH122 with an FZP lens in the outermost position (D2). See <a href="https://developer.acconeer.com/download/getting-started-guide-lenses-pdf/">Getting Started Guide Lenses</a> for more information about lenses and performance.</p>
<p>Two different test setups was used. One without a lid on the tank and one with a lid on the tank with the sensor measuring through the plastic.</p>
<div class="image">
<img src="tank-level-setup.jpg" alt="Tank setup without a lid"/>
</div>
<p>{width=60%}</p>
<div class="image">
<img src="tank-level-XM122-setup.jpg" alt="XM122 setup on tank without a lid"/>
</div>
<p>{width=60%}</p>
<div class="image">
<img src="tank-level-lid-setup.jpg" alt="Tank setup with a lid"/>
</div>
<p>{width=60%}</p>
<div class="image">
<img src="tank-level-lid-XM122-setup.jpg" alt="XM122 setup on tank with a lid"/>
</div>
<p>{width=60%}</p>
<h3>Test execution</h3>
<p>The test was performed by measuring the water level while filling and emptying the tank. First, the backgrounds for the close and mid range are recorded while the tank is empty. Then, water is filled until the water level is just beneath the lens and the water is let out again.</p>
<h3>Test results</h3>
<p>The empty tank is ~0.8 m. Since the tap on the tank was ~0.05 m from the bottom of the tank, it is not completely emptied during testing.</p>
<h4>Result without a lid</h4>
<div class="image">
<img src="tank-level-filling-and-emptying.png" alt="Filling and emptying tank without a lid"/>
</div>
<p>{width=80%}</p>
<p>The graph shows how the water surface gets closer to the sensor when the tank is filled. It is clear to see that the surface reaches the mid range at 0.47 m and the characteristics of the line changes. Also, at 0.12 m the surface reaches the close range. The distance accuracy is not as good when measuring in the close range since the measurement is affected by the direct leakage and the close range measures the distance to the first sample point above threshold rather than the distance to the center of a peak.</p>
<h4>Result with a lid</h4>
<div class="image">
<img src="tank-level-lid-filling-and-emptying.png" alt="Filling and emptying tank with a lid"/>
</div>
<p>{width=80%}</p>
<p>The result is very similar to the result without a lid. The application work equally good in free air as through the plastic lid.</p>
<h2>Limitations</h2>
<p>There are limitations to the tank level application. The sensor calibration can fail if the water surface is too close to the sensor during sensor calibration. This is an issue if the sensor is re-calibrated between measurements due to a long time between measurements.</p>
<p>If the lens becomes wet because of liquid touching the lens or because of condensation, the measurement can become faulty since the lens will become visible to the sensor. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
